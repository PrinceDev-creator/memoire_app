<!DOCTYPE html>
<html>
<head>
    <title>Relations élève-parent-école-classe</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th {
            background: linear-gradient(90deg, #4f8cff 0%, #1e3c72 100%);
            color: #fff;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .search-bar { margin-bottom: 20px; }
        .search-bar input { padding: 6px; border-radius: 4px; border: 1px solid #aaa; width: 300px; }
    </style>
    <script>
    function filterTable() {
        var input = document.getElementById("searchInput");
        var filter = input.value.toLowerCase();
        var table = document.getElementById("followTable");
        var trs = table.getElementsByTagName("tr");
        var columnSelect = document.getElementById("columnSelect");
        var colIndex = columnSelect.value;
        for (var i = 1; i < trs.length; i++) {
            var tds = trs[i].getElementsByTagName("td");
            var show = false;
            if (colIndex === "all") {
                for (var j = 0; j < tds.length; j++) {
                    var txtValue = tds[j].textContent || tds[j].innerText;
                    if (txtValue.toLowerCase().indexOf(filter) > -1) { show = true; break; }
                }
            } else {
                var idx = parseInt(colIndex);
                if (tds[idx]) {
                    var txtValue = tds[idx].textContent || tds[idx].innerText;
                    if (txtValue.toLowerCase().indexOf(filter) > -1) { show = true; }
                }
            }
            trs[i].style.display = show ? "" : "none";
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById("columnSelect").addEventListener("change", filterTable);
    });
    </script>
</head>
<body>
    <h1>Liste des relations élève-parent-école-classe</h1>
    <div class="search-bar">
        <label for="columnSelect">Filtrer par :</label>
        <select id="columnSelect">
            <option value="all">Toutes les colonnes</option>
            <option value="0">Élève</option>
            <option value="1">Tuteur</option>
            <option value="2">Classe</option>
            <option value="3">Année académique</option>
            <option value="4">Numéro d'inscription</option>
        </select>
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Tapez pour filtrer...">
    </div>
    <table id="followTable">
        <thead>
            <tr>
                <th>Élève</th>
                <th>Tuteur</th>
                <th>Classe</th>
                <th>Année académique</th>
                <th>Numéro d'inscription</th>
            </tr>
        </thead>
        <tbody>
            {% for follow in follows %}
            <tr>
                <td>{{ follow.student.first_name }} {{ follow.student.last_name }}</td>
                <td>
                    {% if follow.tutor %}
                        {{ follow.tutor.first_name }} {{ follow.tutor.last_name }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {{ follow.level.name }}
                    {% if follow.level.series %}
                        {{ follow.level.series }}
                    {% endif %}
                    {% if follow.level.group %}
                        {{ follow.level.group }}
                    {% endif %}
                </td>
                <td>{{ follow.academic_year }}</td>
                <td>{{ follow.registration_number }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">Aucun suivi trouvé.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>